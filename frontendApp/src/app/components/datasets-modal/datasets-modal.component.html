<ion-modal #modal (willDismiss)="closeModalAddConnection()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title i18n>
            @if(dataset){
              Edit connection
            }@else {
              Dataset informations
            }
          </ion-title>
        </ion-toolbar>
      </ion-header>
      <div class="inner-content" (submit)="addConnection($event)">
        <form [formGroup]="formDatabase" enctype="multipart/form-data">
          @if(!dataset){
            <ion-item>
              <div id="datatypes">
                <ion-label id="datatypes-title" i18n>Data types</ion-label>
                <ion-radio-group id="datatypes-options" formControlName="type" (ionChange)="onSelectionChange()">
                  @for(a of datasetTypes; track a; let x = $index){
                    <ion-card class="radio-container">
                      <ion-radio class="datatypes-radio cards" color="transparent" value="{{ a.dataType }}" (click)="onSelected($event)">
                        <ion-icon name="{{ a.logo }}" color="primary"></ion-icon>
                        {{ a.dataName }}
                      </ion-radio>
                    </ion-card>
                  }
                </ion-radio-group>
              </div>
            </ion-item>
          }
          @if(formDatabase.value.type){

            <ion-item>
              <ion-input label="Enter the name" labelPlacement="stacked" type="text" placeholder="Name"
              formControlName="name" i18n></ion-input>
            </ion-item>
          }

          <!-- FORM FOR FILE-->
          <ng-container *ngIf="formDatabase.value.type === 'file'">
            <ion-item>
              <ion-input label="Drop or select a file (json, csv, tsv, parquet, feather, orc, avro, xls, xml)" labelPlacement="stacked" type="file" placeholder="File"
                formControlName="file" (change)="uploadFile($event)"  accept=".json, .csv, .parquet, .feather, .avro, .orc" i18n></ion-input>
            </ion-item>
            <ion-item>
              <span class="container">
                <ion-label class="label" id="folder-label" i18n>Drop or select a folder</ion-label>
                <input type="file" placeholder="File" formControlName="file" (change)="uploadFile($event)"  accept=".json, .csv, .parquet, .feather, .avro, .orc" webkitdirectory directory multiple i18n>
              </span>
            </ion-item>
            <ion-item>
              <ion-input label="Enter a local file or folder" labelPlacement="stacked" type="text" placeholder=" path/to/file"
               formControlName="filePath" (change)="uploadFile($event)" i18n></ion-input>
            </ion-item>
            <div *ngIf="uploadProgress !== null">
              <progress [value]="uploadProgress" max="100"></progress>
            </div>
            @if (isCsvFile) {
              <ion-item class="csv-input">
                <span class="container">
                  <ion-label class="label" i18n>CSV header</ion-label>
                  <ion-radio-group label="Enter a local path" formControlName="csvHeader" id="csv-header-radio" i18n>
                    <ion-radio labelPlacement="end" value="true">yes</ion-radio>
                    <ion-radio labelPlacement="end" value="false">no</ion-radio>
                  </ion-radio-group>
                </span>
              </ion-item>
              <ion-item class="csv-input">
                <ion-input label="CSV delimiter" labelPlacement="stacked" type="text" formControlName="csvDelimiter" i18n></ion-input>
              </ion-item>
            }
          </ng-container>

          <!-- FORM FOR MONGODB-->
          <ng-container *ngIf="formDatabase.value.type === 'mongo'">
            <ion-item>
              <ion-input label="Enter the URI" labelPlacement="stacked" type="text" placeholder="URI"
                formControlName="uri" i18n></ion-input>
            </ion-item>
            <ion-item>
              <ion-input label="Enter the database (optional)" labelPlacement="stacked" type="text" placeholder="Database"
                formControlName="database" i18n></ion-input>
            </ion-item>
            <ion-item>
              <ion-input label="Enter the collection (optional)" labelPlacement="stacked" type="text"
                placeholder="Collection" formControlName="collection" i18n></ion-input>
            </ion-item>
          </ng-container>

          <!-- FORM FOR MYSQL-->
          <ng-container *ngIf="formDatabase.value.type === 'mysql'">
            <ion-item>
              <ion-input label="Enter the host" labelPlacement="stacked" type="text" placeholder="Host"
                formControlName="host" i18n></ion-input>
            </ion-item>
            <ion-item>
              <ion-input label="Enter the user" labelPlacement="stacked" type="text" placeholder="User"
                formControlName="user" i18n></ion-input>
            </ion-item>
            <ion-item>
              <ion-input label="Enter the password" labelPlacement="stacked" type="text" placeholder="Password"
                formControlName="password" i18n></ion-input>
            </ion-item>
            <ion-item>
              <ion-input label="Enter the database" labelPlacement="stacked" type="text" placeholder="DB"
                formControlName="database" i18n></ion-input>
            </ion-item>
            <ion-item>
              <ion-input label="Enter the table" labelPlacement="stacked" type="text" placeholder="Table"
                formControlName="table" i18n></ion-input>
            </ion-item>
          </ng-container>

          <!-- FORM FOR API-->
          <ng-container *ngIf="formDatabase.value.type === 'api'">
            <ion-item>
                  <ion-select label="Select authorization method" placeholder="" formControlName="apiAuth" i18n>
                    <ion-select-option value="none">None</ion-select-option>
                    <ion-select-option value="bearer">Bearer Token</ion-select-option>
                    <ion-select-option value="oauth2">OAuth2</ion-select-option>
                  </ion-select>
            </ion-item>

            <ng-container *ngIf="formDatabase.value.apiAuth === 'none'">
              <ion-item>
                <ion-input label="Enter the URL" labelPlacement="stacked" type="text" placeholder="URL"
                  formControlName="url" i18n></ion-input>
              </ion-item>
              <ion-item>
                <ion-input label="Enter the name" labelPlacement="stacked" type="text" placeholder="Name"
                  formControlName="name" i18n></ion-input>
              </ion-item>
            </ng-container>

            <ng-container *ngIf="formDatabase.value.apiAuth === 'bearer'">
              <ion-item>
                <ion-input label="Enter the URL" labelPlacement="stacked" type="text" placeholder="URL"
                  formControlName="url" i18n></ion-input>
              </ion-item>
              <ion-item>
                <ion-input label="Enter bearer token (optional)" labelPlacement="stacked" type="text" placeholder="Bearer Token"
                  formControlName="bearerToken" i18n></ion-input>
              </ion-item>
            </ng-container>

            <ng-container *ngIf="formDatabase.value.apiAuth === 'oauth2'">
              <ion-item>
                <ion-input label="Enter the URL" labelPlacement="stacked" type="text" placeholder="URL"
                  formControlName="url" i18n></ion-input>
              </ion-item>
              <ion-item>
                <ion-input label="Enter the authorization URL" labelPlacement="stacked" type="text" placeholder="Authorization URL"
                  formControlName="authUrl" i18n></ion-input>
              </ion-item>
              <ion-item>
                <ion-input label="Enter basic auth token (optional)" labelPlacement="stacked" type="text" placeholder="Basic auth token"
                  formControlName="basicToken" i18n></ion-input>
              </ion-item>
              <ion-item>
                <ion-input label="Enter client id (optional)" labelPlacement="stacked" type="text" placeholder="Client id"
                  formControlName="clientId"> i18n</ion-input>
              </ion-item>
              <ion-item>
                <ion-input label="Enter client secret (optional)" labelPlacement="stacked" type="text" placeholder="Client secret"
                  formControlName="clientSecret" i18n></ion-input>
              </ion-item>
            </ng-container>
          </ng-container>


          <!-- FORM FOR ELASTIC SEARCH-->
          <ng-container *ngIf="formDatabase.value.type === 'elastic'">
            <ion-item>
              <ion-input label="Enter the URL" labelPlacement="stacked" type="text" placeholder="URL"
                formControlName="url" i18n></ion-input>
            </ion-item>
            <ion-item>
              <ion-input label="Enter the username" labelPlacement="stacked" type="text" placeholder="Username"
                formControlName="name" i18n></ion-input>
            </ion-item>
            <ion-item>
              <ion-input label="Enter the password" labelPlacement="stacked" type="text" placeholder="Password"
                formControlName="password" i18n></ion-input>
            </ion-item>
            <ion-item>
              <ion-input label="Enter the API key" labelPlacement="stacked" type="text" placeholder="API key"
                formControlName="api key" i18n></ion-input>
            </ion-item>
            <ion-item>
              <ion-input label="Enter the bearer token" labelPlacement="stacked" type="text" placeholder="Bearer token"
                formControlName="bearerToken" i18n></ion-input>
            </ion-item>

          </ng-container>


          <!-- FORM FOR PTX -->
          <ng-container *ngIf="formDatabase.value.type === 'ptx'">
            <ion-item>
              <ion-input label="Enter the PDC URL" labelPlacement="stacked" type="text" placeholder="URL"
                formControlName="url" i18n></ion-input>
            </ion-item>
            <ion-item>
              <ion-input label="Service key" labelPlacement="stacked" type="password" placeholder="Service key"
                formControlName="service_key" autocomplete="off" i18n></ion-input>
            </ion-item>
            <ion-item>
              <ion-input label="Secret key" labelPlacement="stacked" type="password" placeholder="Secret key"
                formControlName="secret_key" autocomplete="off" i18n></ion-input>
            </ion-item>
          </ng-container>
          <!-- -->

          <ion-item lines="none" id="confirm-container">
            <!-- la page se rafraichit quand on clique sur le bouton (click)="refreshPage()"-->
            <ion-button size="medium" type="submit" id="confirm" i18n>Confirm</ion-button>
          </ion-item>
        </form>
      </div>
    </ng-template>
  </ion-modal>
